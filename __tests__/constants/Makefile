# Makefile pour tester la centralisation des constantes
# Tests directs des headers C++ constants

CXX = g++
CXXFLAGS = -std=c++17 -Wall -Wextra -I.
TARGETS = test_core test_effect test_safety test_utils

.PHONY: all clean test help

all: test

help:
	@echo "ğŸ§ª TESTS UNITAIRES - CENTRALISATION DES CONSTANTES"
	@echo "=================================================="
	@echo "Commandes disponibles:"
	@echo "  make test    - ExÃ©cuter tous les tests"
	@echo "  make clean   - Nettoyer les fichiers temporaires"
	@echo "  make help    - Afficher cette aide"

test: $(TARGETS)
	@echo ""
	@echo "ğŸ¯ EXÃ‰CUTION DES TESTS:"
	@echo "======================"
	@echo ""
	@echo "ğŸ“‹ Testing CoreConstants.hpp..."
	@./test_core && echo "âœ… CoreConstants.hpp - PASSED" || echo "âŒ CoreConstants.hpp - FAILED"
	@echo ""
	@echo "ğŸ“‹ Testing EffectConstants.hpp..."
	@./test_effect && echo "âœ… EffectConstants.hpp - PASSED" || echo "âŒ EffectConstants.hpp - FAILED"
	@echo ""
	@echo "ğŸ“‹ Testing SafetyContants.hpp..."
	@./test_safety && echo "âœ… SafetyContants.hpp - PASSED" || echo "âŒ SafetyContants.hpp - FAILED"
	@echo ""
	@echo "ğŸ“‹ Testing utilsConstants.hpp..."
	@./test_utils && echo "âœ… utilsConstants.hpp - PASSED" || echo "âŒ utilsConstants.hpp - FAILED"
	@echo ""
	@echo "ğŸ‰ TOUS LES TESTS TERMINÃ‰S !"
	@echo "=============================="
	@echo "ğŸ“Š BILAN DE LA CENTRALISATION :"
	@echo "   ğŸ“ CoreConstants.hpp    : ~50 constantes (Equalizer, Biquad)"
	@echo "   ğŸ“ EffectConstants.hpp  : ~56 constantes (Compressor, Delay)"
	@echo "   ğŸ“ SafetyContants.hpp   : ~50 constantes (Audio Protection)"
	@echo "   ğŸ“ utilsConstants.hpp   : ~56 constantes (Buffers, SIMD, Utils)"
	@echo "   ğŸ“ˆ TOTAL                : ~212 constantes centralisÃ©es !"
	@echo ""
	@echo "âœ… ZÃ©ro duplication"
	@echo "âœ… ZÃ©ro nombre magique"
	@echo "âœ… Cross-platform compatible"
	@echo "âœ… Namespaces organisÃ©s"
	@echo "âœ… Performance optimisÃ©e (constexpr)"

test_core: test_core_constants.cpp
	@echo "ğŸ”¨ Compiling CoreConstants test..."
	@$(CXX) $(CXXFLAGS) -o $@ $<

test_effect: test_effect_constants.cpp
	@echo "ğŸ”¨ Compiling EffectConstants test..."
	@$(CXX) $(CXXFLAGS) -o $@ $<

test_safety: test_safety_constants.cpp
	@echo "ğŸ”¨ Compiling SafetyConstants test..."
	@$(CXX) $(CXXFLAGS) -o $@ $<

test_utils: test_utils_constants.cpp
	@echo "ğŸ”¨ Compiling UtilsConstants test..."
	@$(CXX) $(CXXFLAGS) -o $@ $<

clean:
	@echo "ğŸ§¹ Cleaning up..."
	@rm -f $(TARGETS)
	@echo "âœ… Clean complete"

# Tests de compilation uniquement (sans exÃ©cution)
compile-only:
	@echo "ğŸ”¨ Testing compilation only..."
	@$(CXX) $(CXXFLAGS) -c test_core_constants.cpp && echo "âœ… CoreConstants compiles OK" || echo "âŒ CoreConstants compilation failed"
	@$(CXX) $(CXXFLAGS) -c test_effect_constants.cpp && echo "âœ… EffectConstants compiles OK" || echo "âŒ EffectConstants compilation failed"
	@$(CXX) $(CXXFLAGS) -c test_safety_constants.cpp && echo "âœ… SafetyConstants compiles OK" || echo "âŒ SafetyConstants compilation failed"
	@$(CXX) $(CXXFLAGS) -c test_utils_constants.cpp && echo "âœ… UtilsConstants compiles OK" || echo "âŒ UtilsConstants compilation failed"
	@rm -f *.o

# Test avec diffÃ©rents niveaux d'optimisation
test-optimized:
	@echo "âš¡ Testing with optimization..."
	@$(CXX) $(CXXFLAGS) -O2 -DNDEBUG -o test_core_opt test_core_constants.cpp
	@./test_core_opt && echo "âœ… CoreConstants - Optimized OK"
	@rm -f test_core_opt

# Test de compatibilitÃ© C++17 (fallback)
test-cpp17:
	@echo "ğŸ”„ Testing C++17 compatibility..."
	@$(CXX) -std=c++17 -Wall -Wextra -I. -o test_core_17 test_core_constants.cpp && echo "âœ… C++17 compatible" || echo "âš ï¸ C++17 incompatible"
	@rm -f test_core_17
